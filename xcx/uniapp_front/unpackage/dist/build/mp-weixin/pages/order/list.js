"use strict";const e=require("../../common/vendor.js"),t=require("../../store/order.js"),r=require("../../store/user.js"),o=require("../../mixins/theme.js"),a={setup(){const a=t.useOrderStore(),s=r.useUserStore(),{currentTheme:n,getThemeColor:i,getButtonStyle:d,getHeaderStyle:c}=o.useTheme(),l=e.ref(0),u=e.computed((()=>s.isLoggedIn)),g=[{id:"demo-1",creator:"demo",creator_username:"演示用户",status:"PENDING",notes:"这是一个演示订单，登录后查看真实数据",total_price:"45.00",created_at:"2024-06-22T10:30:00Z",items:[{product:{name:"宫保鸡丁",price:"25.00"},quantity:1},{product:{name:"米饭",price:"3.00"},quantity:2}]},{id:"demo-2",creator:"demo",creator_username:"演示用户",status:"COMPLETED",notes:"美味的午餐",total_price:"32.00",created_at:"2024-06-21T12:15:00Z",items:[{product:{name:"红烧肉",price:"28.00"},quantity:1},{product:{name:"汤",price:"4.00"},quantity:1}]}],m=[{id:"demo-3",creator:"demo-partner",creator_username:"TA",status:"CONFIRMED",notes:"TA为你点的爱心餐",total_price:"38.00",created_at:"2024-06-22T11:00:00Z",items:[{product:{name:"糖醋里脊",price:"26.00"},quantity:1},{product:{name:"蛋花汤",price:"6.00"},quantity:2}]}],p=e.computed((()=>u.value?a.sentOrders:g)),h=e.computed((()=>u.value?a.receivedOrders:m)),T=async()=>{if(s.isLoggedIn){console.log("刷新订单数据...");try{await Promise.all([a.fetchSentOrders(),a.fetchReceivedOrders()]),console.log("订单数据刷新完成")}catch(e){console.error("刷新订单数据失败:",e)}}};e.onMounted((()=>{s.isLoggedIn&&(a.initOrders(),T())})),e.onShow((()=>{console.log("订单页面显示"),s.isLoggedIn&&T()}));const S=e.computed((()=>({color:n.value.primaryColor}))),y=e.computed((()=>({color:n.value.primaryColor})));return{isLoggedIn:u,orderStore:a,currentTab:l,tabList:[{name:"我发出的"},{name:"我收到的"}],displaySentOrders:p,displayReceivedOrders:h,goToLogin:()=>{e.index.navigateTo({url:"/pages/public/login"})},handleTabClick:e=>{l.value=e.index},handleSwiperChange:e=>{l.value=e.detail.current},formatDate:t=>e.dayjs(t).format("MM-DD HH:mm"),getStatusText:e=>({PENDING:"待处理",CONFIRMED:"已确认",ORDERED:"已下单",COMPLETED:"已完成",RATED:"已评价",CANCELLED:"已取消",pending:"待处理",accepted:"已接收",completed:"已完成"}[e]||"未知"),getStatusClass:e=>`status-${e}`,navigateToDetail:t=>{u.value||!t.startsWith("demo-")?e.index.navigateTo({url:`/pages/order/detail?id=${t}`}):e.index.showToast({title:"请登录查看订单详情",icon:"none"})},handleRefresh:()=>{e.index.showToast({title:"刷新中...",icon:"loading"}),T().then((()=>{e.index.hideToast(),e.index.showToast({title:"刷新完成",icon:"success",duration:1e3})}))},refreshOrders:T,currentTheme:n,getThemeColor:i,getButtonStyle:d,getHeaderStyle:c,tabActiveStyle:S,totalPriceStyle:y}}};const s=e._export_sfc(a,[["render",function(t,r,o,a,s,n){return e.e({a:!a.isLoggedIn},a.isLoggedIn?{}:{b:e.o(((...e)=>a.goToLogin&&a.goToLogin(...e)))},{c:e.f(a.tabList,((t,r,o)=>({a:e.t(t.name),b:r,c:a.currentTab===r?1:"",d:e.s(a.currentTab===r?a.tabActiveStyle:{}),e:e.o((e=>a.handleTabClick({index:r})),r)}))),d:e.o(((...e)=>a.handleRefresh&&a.handleRefresh(...e))),e:a.isLoggedIn&&"loading"===a.orderStore.status},a.isLoggedIn&&"loading"===a.orderStore.status?{}:e.e({f:e.f(a.displaySentOrders,((t,r,o)=>e.e({a:e.t(t.id),b:e.t(a.getStatusText(t.status)),c:e.n(a.getStatusClass(t.status)),d:e.t(a.formatDate(t.created_at||t.createTime)),e:e.t(t.items.length),f:e.t(t.total_price||t.totalPrice),g:t.notes||t.note},t.notes||t.note?{h:e.t(t.notes||t.note)}:{},{i:t.id,j:e.o((e=>a.navigateToDetail(t.id)),t.id)}))),g:e.s(a.totalPriceStyle),h:0===a.displaySentOrders.length},(a.displaySentOrders.length,{})),{i:a.isLoggedIn&&"loading"===a.orderStore.status},a.isLoggedIn&&"loading"===a.orderStore.status?{}:e.e({j:e.f(a.displayReceivedOrders,((t,r,o)=>e.e({a:e.t(t.id),b:e.t(a.getStatusText(t.status)),c:e.n(a.getStatusClass(t.status)),d:e.t(a.formatDate(t.created_at||t.createTime)),e:e.t(t.items.length),f:e.t(t.total_price||t.totalPrice),g:t.notes||t.note},t.notes||t.note?{h:e.t(t.notes||t.note)}:{},{i:t.id,j:e.o((e=>a.navigateToDetail(t.id)),t.id)}))),k:e.s(a.totalPriceStyle),l:0===a.displayReceivedOrders.length},(a.displayReceivedOrders.length,{})),{m:a.currentTab,n:e.o(((...e)=>a.handleSwiperChange&&a.handleSwiperChange(...e)))})}]]);wx.createPage(s);
