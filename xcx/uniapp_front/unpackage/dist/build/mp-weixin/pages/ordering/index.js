"use strict";const e=require("../../common/vendor.js"),t=require("../../store/menu.js"),o=require("../../store/cart.js"),r=require("../../store/user.js"),a=require("../../mixins/theme.js"),n=require("../../config/index.js"),u={setup(){const u=t.useMenuStore(),c=o.useCartStore(),l=r.useUserStore(),{currentTheme:d,getThemeColor:i,getButtonStyle:s,getHeaderStyle:g}=a.useTheme(),m=e.ref(!1),y=e.ref(null),C=e.ref(0),p=e.computed((()=>l.isLoggedIn)),S=()=>{const e=u.useRealApi,t=l.isLoggedIn;t!==e?(console.log(`数据源切换: ${e?"真实":"模拟"} -> ${t?"真实":"模拟"}`),u.setApiMode(t),u.fetchMenuData()):t?console.log("用户已登录，使用真实API数据"):console.log("用户未登录，使用模拟数据")};e.onMounted((()=>{S(),c.initCart()})),e.onShow((()=>{console.log("点餐页面显示，检查登录状态"),S()}));const v=e.computed((()=>{var e;return(null==(e=u.categories.find((e=>e.id===u.currentCategoryId)))?void 0:e.name)||""})),h=e.computed((()=>{const e=u.categories.find((e=>e.id===u.currentCategoryId));return e?e.description:""})),P=n.getProductImageUrl,I=e.computed((()=>({borderRightColor:d.value.primaryColor}))),Q=e.computed((()=>({color:d.value.primaryColor}))),T=e.computed((()=>({backgroundColor:d.value.primaryColor}))),w=e.computed((()=>({color:d.value.primaryColor}))),f=e.computed((()=>({background:`linear-gradient(135deg, ${d.value.primaryColor}, ${d.value.secondaryColor})`}))),x=e.computed((()=>({backgroundColor:d.value.primaryColor}))),D=e.computed((()=>({backgroundColor:d.value.secondaryColor}))),M=e.computed((()=>({color:d.value.primaryColor}))),b=e.computed((()=>({background:`linear-gradient(135deg, ${d.value.primaryColor}, ${d.value.secondaryColor})`})));return{menuStore:u,cartStore:c,isLoggedIn:p,showProductModal:m,selectedProduct:y,currentQuantity:C,currentCategoryName:v,currentCategoryDesc:h,getGreeting:()=>{const e=(new Date).getHours();return e<12?"早餐时光，为TA准备营养早餐吧":e<14?"午餐时间，来点什么好呢？":e<18?"下午茶时光，甜蜜一下":"晚餐时间，和TA一起享受美食"},getCategoryProductCount:e=>{var t;return(null==(t=u.products[e])?void 0:t.length)||0},handleCategoryChange:e=>{u.setCurrentCategory(e)},handleQuantityChange:(e,t)=>{c.setItemQuantity(t,e.value)},showProductDetail:e=>{y.value=e;const t=c.getItemQuantity(e.id);C.value=t>0?t:1,m.value=!0},increaseQuantity:()=>{console.log("点击增加按钮，当前商品:",y.value),y.value?(C.value++,console.log("数量增加到:",C.value)):console.log("商品未选择")},decreaseQuantity:()=>{console.log("点击减少按钮，当前数量:",C.value),C.value>1?(C.value--,console.log("数量减少到:",C.value)):console.log("数量已经是最小值")},addToCart:()=>{y.value&&C.value>0&&(console.log("加入购物车:",y.value,C.value),c.setItemQuantity(y.value,C.value),m.value=!1,e.index.showToast({title:"已加入购物车",icon:"success"}))},addProductToCart:t=>{if(console.log("=== 点击加号按钮 ==="),console.log("商品信息:",t),console.log("商品ID:",null==t?void 0:t.id),console.log("商品名称:",null==t?void 0:t.name),t){console.log("添加到购物车");try{c.setItemQuantity(t,1),console.log("购物车操作完成"),e.index.showToast({title:"已加入购物车",icon:"success"})}catch(o){console.error("购物车操作失败:",o),e.index.showToast({title:"添加失败",icon:"error"})}}else console.log("商品信息无效"),e.index.showToast({title:"商品信息无效",icon:"none"})},increaseProductQuantity:e=>{const t=c.getItemQuantity(e.id);c.setItemQuantity(e,t+1)},decreaseProductQuantity:e=>{const t=c.getItemQuantity(e.id);t>1?c.setItemQuantity(e,t-1):1===t&&c.setItemQuantity(e,0)},showCartDetail:()=>{e.index.showToast({title:`购物车中有${c.totalItems}件商品`,icon:"none"})},goToConfirm:()=>{0!==c.totalItems?e.index.navigateTo({url:"/pages/order/confirm"}):e.index.showToast({title:"请先选择商品",icon:"none"})},goToLogin:()=>{e.index.navigateTo({url:"/pages/public/login"})},reloadMenu:()=>{u.fetchMenuData()},getProductImageUrl:P,currentTheme:d,getThemeColor:i,getButtonStyle:s,getHeaderStyle:g,categoryActiveStyle:I,categoryNameActiveStyle:Q,productCountStyle:T,productPriceStyle:w,addButtonStyle:f,cartIconStyle:x,cartBadgeStyle:D,totalPriceStyle:M,checkoutButtonStyle:b}}};if(!Array){(e.resolveComponent("u-loading-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-empty")+e.resolveComponent("u-transition"))()}const c=e._export_sfc(u,[["render",function(t,o,r,a,n,u){return e.e({a:e.t(a.getGreeting()),b:e.t(a.isLoggedIn?"真实数据":"模拟数据"),c:!a.isLoggedIn},a.isLoggedIn?{}:{d:e.o(((...e)=>a.goToLogin&&a.goToLogin(...e)))},{e:e.s(a.getHeaderStyle()),f:e.f(a.menuStore.categories,((t,o,r)=>e.e({a:e.t(t.name),b:e.s(t.id===a.menuStore.currentCategoryId?a.categoryNameActiveStyle:{}),c:a.getCategoryProductCount(t.id)>0},a.getCategoryProductCount(t.id)>0?{d:e.t(a.getCategoryProductCount(t.id)),e:e.s(a.productCountStyle)}:{},{f:t.id,g:e.n({active:t.id===a.menuStore.currentCategoryId}),h:e.s(t.id===a.menuStore.currentCategoryId?a.categoryActiveStyle:{}),i:e.o((e=>a.handleCategoryChange(t.id)),t.id)}))),g:"loading"===a.menuStore.status},"loading"===a.menuStore.status?{h:e.p({text:"正在加载菜单...",size:"24"})}:"error"===a.menuStore.status?{j:e.o(a.reloadMenu),k:e.p({text:"重新加载",type:"primary",size:"small"}),l:e.p({text:"加载失败",mode:"error"})}:e.e({m:e.t(a.currentCategoryName),n:e.t(a.currentCategoryDesc),o:0===a.menuStore.currentProducts.length},0===a.menuStore.currentProducts.length?{p:e.p({text:"该分类暂无商品",mode:"data"})}:{q:e.f(a.menuStore.currentProducts,((t,o,r)=>e.e({a:a.getProductImageUrl(t),b:e.o((e=>a.showProductDetail(t)),t.id),c:e.t(t.name),d:e.t(t.description),e:e.t(t.price),f:e.o((e=>a.showProductDetail(t)),t.id),g:a.cartStore.getItemQuantity(t.id)>0},a.cartStore.getItemQuantity(t.id)>0?{h:e.o((e=>a.decreaseProductQuantity(t)),t.id),i:e.t(a.cartStore.getItemQuantity(t.id)),j:e.o((e=>a.increaseProductQuantity(t)),t.id)}:{k:e.s(a.addButtonStyle),l:e.o((e=>a.addProductToCart(t)),t.id)},{m:t.id}))),r:e.s(a.productPriceStyle)}),{i:"error"===a.menuStore.status,s:e.t(a.cartStore.totalItems),t:e.s(a.cartBadgeStyle),v:e.s(a.cartIconStyle),w:e.t(a.cartStore.totalItems),x:e.t(a.cartStore.totalPrice),y:e.s(a.totalPriceStyle),z:e.o(((...e)=>a.showCartDetail&&a.showCartDetail(...e))),A:e.s(a.checkoutButtonStyle),B:e.o(((...e)=>a.goToConfirm&&a.goToConfirm(...e))),C:0===a.cartStore.totalItems,D:e.p({show:a.cartStore.totalItems>0,mode:"slide-up"}),E:a.showProductModal},a.showProductModal?e.e({F:a.selectedProduct},a.selectedProduct?{G:e.o((e=>a.showProductModal=!1)),H:a.getProductImageUrl(a.selectedProduct),I:e.t(a.selectedProduct.name),J:e.t(a.selectedProduct.description),K:e.t(a.selectedProduct.price),L:e.s(a.productPriceStyle),M:e.o(((...e)=>a.decreaseQuantity&&a.decreaseQuantity(...e))),N:a.currentQuantity<=1,O:e.t(a.currentQuantity),P:e.o(((...e)=>a.increaseQuantity&&a.increaseQuantity(...e))),Q:e.s(a.addButtonStyle),R:e.o(((...e)=>a.addToCart&&a.addToCart(...e))),S:a.currentQuantity<=0,T:e.o((()=>{}))}:{},{U:e.o((e=>a.showProductModal=!1))}):{})}]]);wx.createPage(c);
