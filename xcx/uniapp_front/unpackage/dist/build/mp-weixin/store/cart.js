"use strict";const t=require("../common/vendor.js"),e=require("../utils/storage.js"),i=t.defineStore("cart",{state:()=>({items:{}}),getters:{totalItems:t=>Object.values(t.items).reduce(((t,{quantity:e})=>t+e),0),totalPrice:t=>Object.values(t.items).reduce(((t,{item:e,quantity:i})=>t+e.price*i),0).toFixed(2),getItemQuantity:t=>function(e){const i=t.items[e];return i?i.quantity:0}},actions:{loadCartFromLocal(){const t=e.Storage.get(e.STORAGE_KEYS.CART_ITEMS,{});this.items=t},saveCartToLocal(){e.Storage.set(e.STORAGE_KEYS.CART_ITEMS,this.items)},addItem(t){console.log("CartStore addItem - 商品数据:",t),t&&t.id?(this.items[t.id]?(this.items[t.id].quantity++,console.log("增加商品数量:",this.items[t.id])):(this.items[t.id]={item:t,quantity:1},console.log("新增商品到购物车:",this.items[t.id])),this.saveCartToLocal()):console.error("商品数据无效:",t)},removeItem(t){this.items[t]&&this.items[t].quantity>1?this.items[t].quantity--:this.items[t]&&delete this.items[t],this.saveCartToLocal()},setItemQuantity(t,e){console.log("CartStore setItemQuantity - 商品数据:",t,"数量:",e),t&&t.id?(e>0?(this.items[t.id]={item:t,quantity:e},console.log("设置商品数量:",this.items[t.id])):(delete this.items[t.id],console.log("删除商品:",t.id)),this.saveCartToLocal()):console.error("商品数据无效:",t)},clearCart(){this.items={},this.saveCartToLocal()},initCart(){this.loadCartFromLocal()}}});exports.useCartStore=i;
