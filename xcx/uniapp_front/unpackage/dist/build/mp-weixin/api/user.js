"use strict";const e=require("../common/vendor.js"),r=require("./request.js"),t=require("../config/index.js");exports.cancelBindingRequest=function(){return r.request({url:"/users/cancel-binding-request/",method:"POST"})},exports.getBindingHistory=function(){return r.request({url:"/users/binding-history/",method:"GET"})},exports.getBindingInfo=function(){return r.request({url:"/users/binding-info/",method:"GET"})},exports.getCurrentUser=function(){return r.request({url:"/users/me/",method:"GET"})},exports.getPendingBindings=function(){return r.request({url:"/users/pending-bindings/",method:"GET"})},exports.login=function(e){return r.request({url:"/users/login/",method:"POST",data:e})},exports.refreshToken=function(e){return r.request({url:"/token/refresh/",method:"POST",data:{refresh:e}})},exports.respondToBinding=function(e,t){return r.request({url:`/users/${e}/respond-binding/`,method:"POST",data:{action:t}})},exports.sendBindingRequest=function(e,t=""){return r.request({url:"/users/send-binding-request/",method:"POST",data:{email:e,message:t}})},exports.sendVerificationCode=function(e){return r.request({url:"/users/send-code/",method:"POST",data:e})},exports.unbind=function(e){return r.request({url:`/users/${e}/unbind/`,method:"POST"})},exports.updateUserProfile=function(e){return r.request({url:"/users/update-profile/",method:"PUT",data:e})},exports.uploadAvatar=function(r){return new Promise(((n,s)=>{const u=e.index.getStorageSync("token");e.index.uploadFile({url:t.getApiUrl("/users/upload-avatar/"),filePath:r,name:"avatar",header:{Authorization:`Bearer ${u}`},success:e=>{if(console.log("头像上传响应:",e),200===e.statusCode)try{const r=JSON.parse(e.data);n(r)}catch(r){s(new Error("响应数据解析失败"))}else s(new Error(`上传失败: ${e.statusCode}`))},fail:e=>{console.error("头像上传失败:",e),s(e)}})}))},exports.verifyAndLogin=function(e){return r.request({url:"/users/verify-and-login/",method:"POST",data:e})};
