{"version":3,"file":"user.js","sources":["api/user.js"],"sourcesContent":["import request from './request';\r\n\r\n// 场景二：老用户使用密码登录\r\nexport function login(data) {\r\n    return request({\r\n        url: '/users/login/',\r\n        method: 'POST',\r\n        data\r\n    });\r\n}\r\n\r\n// 场景一 & 三：注册或验证码登录\r\nexport function verifyAndLogin(data) {\r\n    return request({\r\n        url: '/users/verify-and-login/',\r\n        method: 'POST',\r\n        data\r\n    });\r\n}\r\n\r\n// 场景一 & 三：发送验证码\r\nexport function sendVerificationCode(data) {\r\n    return request({\r\n        url: '/users/send-code/',\r\n        method: 'POST',\r\n        data\r\n    });\r\n}\r\n\r\n// 刷新Token\r\nexport function refreshToken(refreshToken) {\r\n    return request({\r\n        url: '/token/refresh/',\r\n        method: 'POST',\r\n        data: { refresh: refreshToken }\r\n    });\r\n}\r\n\r\n// 获取当前用户信息\r\nexport function getCurrentUser() {\r\n    return request({\r\n        url: '/users/me/',\r\n        method: 'GET'\r\n    });\r\n}\r\n\r\n// 发送绑定请求\r\nexport function sendBindingRequest(email, message = '') {\r\n    return request({\r\n        url: '/users/send-binding-request/',\r\n        method: 'POST',\r\n        data: { email, message }\r\n    });\r\n}\r\n\r\n// 获取待处理的绑定请求\r\nexport function getPendingBindings() {\r\n    return request({\r\n        url: '/users/pending-bindings/',\r\n        method: 'GET'\r\n    });\r\n}\r\n\r\n// 响应绑定请求\r\nexport function respondToBinding(bindingId, action) {\r\n    return request({\r\n        url: `/users/${bindingId}/respond-binding/`,\r\n        method: 'POST',\r\n        data: { action }\r\n    });\r\n}\r\n\r\n// 解除绑定\r\nexport function unbind(bindingId) {\r\n    return request({\r\n        url: `/users/${bindingId}/unbind/`,\r\n        method: 'POST'\r\n    });\r\n}\r\n\r\n// 获取当前绑定信息\r\nexport function getBindingInfo() {\r\n    return request({\r\n        url: '/users/binding-info/',\r\n        method: 'GET'\r\n    });\r\n}\r\n\r\n// 获取绑定历史记录\r\nexport function getBindingHistory() {\r\n    return request({\r\n        url: '/users/binding-history/',\r\n        method: 'GET'\r\n    });\r\n}\r\n\r\n// 取消绑定请求\r\nexport function cancelBindingRequest() {\r\n    return request({\r\n        url: '/users/cancel-binding-request/',\r\n        method: 'POST'\r\n    });\r\n}\r\n\r\n// 更新用户个人信息\r\nexport function updateUserProfile(data) {\r\n    return request({\r\n        url: '/users/update-profile/',\r\n        method: 'PUT',\r\n        data\r\n    });\r\n}\r\n\r\nimport { getApiUrl } from '@/config/index';\r\n\r\n// 上传用户头像\r\nexport function uploadAvatar(filePath) {\r\n    return new Promise((resolve, reject) => {\r\n        const token = uni.getStorageSync('token');\r\n\r\n        uni.uploadFile({\r\n            url: getApiUrl('/users/upload-avatar/'),\r\n            filePath: filePath,\r\n            name: 'avatar',\r\n            header: {\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            success: (res) => {\r\n                console.log('头像上传响应:', res);\r\n                if (res.statusCode === 200) {\r\n                    try {\r\n                        const data = JSON.parse(res.data);\r\n                        resolve(data);\r\n                    } catch (e) {\r\n                        reject(new Error('响应数据解析失败'));\r\n                    }\r\n                } else {\r\n                    reject(new Error(`上传失败: ${res.statusCode}`));\r\n                }\r\n            },\r\n            fail: (error) => {\r\n                console.error('头像上传失败:', error);\r\n                reject(error);\r\n            }\r\n        });\r\n    });\r\n}"],"names":["request","refreshToken","uni","getApiUrl"],"mappings":";;;;AAGO,SAAS,MAAM,MAAM;AACxB,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR;AAAA,EACR,CAAK;AACL;AAGO,SAAS,eAAe,MAAM;AACjC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR;AAAA,EACR,CAAK;AACL;AAGO,SAAS,qBAAqB,MAAM;AACvC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR;AAAA,EACR,CAAK;AACL;AAGO,SAAS,aAAaC,eAAc;AACvC,SAAOD,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM,EAAE,SAASC,cAAc;AAAA,EACvC,CAAK;AACL;AAGO,SAAS,iBAAiB;AAC7B,SAAOD,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,mBAAmB,OAAO,UAAU,IAAI;AACpD,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM,EAAE,OAAO,QAAS;AAAA,EAChC,CAAK;AACL;AAGO,SAAS,qBAAqB;AACjC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,iBAAiB,WAAW,QAAQ;AAChD,SAAOA,oBAAQ;AAAA,IACX,KAAK,UAAU,SAAS;AAAA,IACxB,QAAQ;AAAA,IACR,MAAM,EAAE,OAAQ;AAAA,EACxB,CAAK;AACL;AAGO,SAAS,OAAO,WAAW;AAC9B,SAAOA,oBAAQ;AAAA,IACX,KAAK,UAAU,SAAS;AAAA,IACxB,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,iBAAiB;AAC7B,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,oBAAoB;AAChC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,uBAAuB;AACnC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,EAChB,CAAK;AACL;AAGO,SAAS,kBAAkB,MAAM;AACpC,SAAOA,oBAAQ;AAAA,IACX,KAAK;AAAA,IACL,QAAQ;AAAA,IACR;AAAA,EACR,CAAK;AACL;AAKO,SAAS,aAAa,UAAU;AACnC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,UAAM,QAAQE,cAAAA,MAAI,eAAe,OAAO;AAExCA,kBAAAA,MAAI,WAAW;AAAA,MACX,KAAKC,aAAS,UAAC,uBAAuB;AAAA,MACtC;AAAA,MACA,MAAM;AAAA,MACN,QAAQ;AAAA,QACJ,iBAAiB,UAAU,KAAK;AAAA,MACnC;AAAA,MACD,SAAS,CAAC,QAAQ;AACdD,sBAAA,MAAA,MAAA,OAAA,sBAAY,WAAW,GAAG;AAC1B,YAAI,IAAI,eAAe,KAAK;AACxB,cAAI;AACA,kBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,oBAAQ,IAAI;AAAA,UACf,SAAQ,GAAG;AACR,mBAAO,IAAI,MAAM,UAAU,CAAC;AAAA,UAC/B;AAAA,QACrB,OAAuB;AACH,iBAAO,IAAI,MAAM,SAAS,IAAI,UAAU,EAAE,CAAC;AAAA,QAC9C;AAAA,MACJ;AAAA,MACD,MAAM,CAAC,UAAU;AACbA,sBAAc,MAAA,MAAA,SAAA,sBAAA,WAAW,KAAK;AAC9B,eAAO,KAAK;AAAA,MACf;AAAA,IACb,CAAS;AAAA,EACT,CAAK;AACL;;;;;;;;;;;;;;;"}