{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\timport { useUserStore } from '@/store/user'\r\n\timport { useOrderStore } from '@/store/order'\r\n\timport { useThemeStore } from '@/store/theme'\r\n\r\n\texport default {\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.log('App Launch')\r\n\r\n\t\t\t// 初始化用户状态\r\n\t\t\tconst userStore = useUserStore()\r\n\t\t\tconst orderStore = useOrderStore()\r\n\t\t\tconst themeStore = useThemeStore()\r\n\r\n\t\t\t// 初始化主题（优先级最高，影响整体UI）\r\n\t\t\tthemeStore.initTheme().then(() => {\r\n\t\t\t\t// 初始化完成后立即应用主题\r\n\t\t\t\tthis.updateCSSVariables(themeStore.currentTheme)\r\n\t\t\t}).catch(err => {\r\n\t\t\t\tconsole.error('主题初始化失败:', err)\r\n\t\t\t\t// 即使初始化失败，也应用默认主题\r\n\t\t\t\tthis.updateCSSVariables(themeStore.currentTheme)\r\n\t\t\t})\r\n\r\n\t\t\t// 立即应用当前主题（不等待异步初始化）\r\n\t\t\tthis.updateCSSVariables(themeStore.currentTheme)\r\n\t\t\tthis.updateTabBarTheme(themeStore.currentTheme)\r\n\t\tthis.updateNavigationBarTheme(themeStore.currentTheme)\r\n\r\n\t\t\t// 监听主题变化，更新CSS变量、TabBar和导航栏\r\n\t\t\tuni.$on('themeChanged', (theme) => {\r\n\t\t\t\tthis.updateCSSVariables(theme)\r\n\t\t\t\tthis.updateTabBarTheme(theme)\r\n\t\t\t\tthis.updateNavigationBarTheme(theme)\r\n\t\t\t})\r\n\r\n\t\t// 监听页面显示，立即设置导航栏主题（无动画）\r\n\t\tuni.$on('onPageShow', (route) => {\r\n\t\t\t// 立即设置，无延迟\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.updateNavigationBarTheme(themeStore.currentTheme, route)\r\n\t\t\t}, 0)\r\n\t\t})\r\n\r\n\t\t\t// 从本地存储恢复用户登录状态\r\n\t\t\tif (userStore.initFromStorage()) {\r\n\t\t\t\t// 如果有token，尝试获取用户信息\r\n\t\t\t\tuserStore.fetchCurrentUser().catch(err => {\r\n\t\t\t\t\tconsole.error('Failed to fetch current user:', err)\r\n\t\t\t\t\t// 如果获取用户信息失败，清除本地状态\r\n\t\t\t\t\tuserStore.clearUserState()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\t// 初始化订单数据\r\n\t\t\torderStore.initOrders()\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n\t\t\t// 更新CSS变量\r\n\t\t\tupdateCSSVariables(theme) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconsole.log('正在更新CSS变量:', theme)\r\n\r\n\t\t\t\t\t// 在H5环境中更新CSS变量\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tconst style = document.documentElement.style\r\n\t\t\t\t\tif (style) {\r\n\t\t\t\t\t\tstyle.setProperty('--theme-primary', theme.primaryColor)\r\n\t\t\t\t\t\tstyle.setProperty('--theme-secondary', theme.secondaryColor)\r\n\t\t\t\t\t\tstyle.setProperty('--theme-background', theme.backgroundColor)\r\n\t\t\t\t\t\tstyle.setProperty('--theme-primary-light', theme.primaryColor + '20')\r\n\t\t\t\t\t\tstyle.setProperty('--theme-secondary-light', theme.secondaryColor + '20')\r\n\t\t\t\t\t\tconsole.log('H5环境CSS变量已更新')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\t// 在小程序环境中，主要通过动态样式绑定实现\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tconsole.log('小程序环境，通过动态样式绑定实现主题')\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log('CSS变量更新失败:', error)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 更新TabBar主题\r\n\t\t\tupdateTabBarTheme(theme) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 检查当前页面是否为TabBar页面\r\n\t\t\t\t\tconst pages = uni.getCurrentPages ? uni.getCurrentPages() : []\r\n\t\t\t\t\tif (pages.length === 0) return\r\n\r\n\t\t\t\t\tconst currentPage = pages[pages.length - 1]\r\n\t\t\t\t\tconst route = currentPage.route\r\n\r\n\t\t\t\t\t// 定义TabBar页面路径\r\n\t\t\t\t\tconst tabBarPages = [\r\n\t\t\t\t\t\t'pages/home/index',\r\n\t\t\t\t\t\t'pages/ordering/index',\r\n\t\t\t\t\t\t'pages/order/list',\r\n\t\t\t\t\t\t'pages/user/index'\r\n\t\t\t\t\t]\r\n\r\n\t\t\t\t\t// 只在TabBar页面设置TabBar样式\r\n\t\t\t\t\tif (tabBarPages.includes(route)) {\r\n\t\t\t\t\t\tconsole.log('正在更新TabBar主题:', theme)\r\n\r\n\t\t\t\t\t\tuni.setTabBarStyle({\r\n\t\t\t\t\t\t\tcolor: '#909399',\r\n\t\t\t\t\t\t\tselectedColor: theme.primaryColor,\r\n\t\t\t\t\t\t\tbackgroundColor: '#ffffff',\r\n\t\t\t\t\t\t\tborderStyle: 'white'\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tconsole.log('TabBar主题已更新')\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log('TabBar主题更新失败:', error)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 更新导航栏主题\r\n\t\t\tupdateNavigationBarTheme(theme, targetRoute = null) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 获取目标路由\r\n\t\t\t\t\tlet route = targetRoute\r\n\t\t\t\t\tif (!route) {\r\n\t\t\t\t\t\t// 使用uni.getCurrentPages()获取当前页面\r\n\t\t\t\t\t\tconst pages = uni.getCurrentPages ? uni.getCurrentPages() : []\r\n\t\t\t\t\t\tif (pages.length === 0) return\r\n\t\t\t\t\t\tconst currentPage = pages[pages.length - 1]\r\n\t\t\t\t\t\troute = currentPage.route\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 定义需要主题导航栏的页面\r\n\t\t\t\t\tconst themePages = [\r\n\t\t\t\t\t\t'pages/settings/index',\r\n\t\t\t\t\t\t'pages/settings/menu-manage',\r\n\t\t\t\t\t\t'pages/settings/theme-config'\r\n\t\t\t\t\t\t// 移除 'pages/user/profile' - 使用默认白色导航栏\r\n\t\t\t\t\t]\r\n\r\n\t\t\t\t\t// 只在指定页面设置导航栏主题\r\n\t\t\t\t\tif (themePages.includes(route)) {\r\n\t\t\t\t\t\tconsole.log('设置导航栏主题:', route, theme.primaryColor)\r\n\r\n\t\t\t\t\t\t// 立即设置导航栏颜色，无动画\r\n\t\t\t\t\t\tuni.setNavigationBarColor({\r\n\t\t\t\t\t\t\tfrontColor: '#ffffff',\r\n\t\t\t\t\t\t\tbackgroundColor: theme.primaryColor,\r\n\t\t\t\t\t\t\tanimation: {\r\n\t\t\t\t\t\t\t\tduration: 0,  // 立即生效，无动画\r\n\t\t\t\t\t\t\t\ttimingFunc: 'linear'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.log('导航栏主题更新失败:', error)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show')\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t/*每个页面公共css */\r\n\t@import \"uview-plus/index.scss\";\r\n\r\n\t/* 主题CSS变量定义 */\r\n\t:root {\r\n\t\t--theme-primary: #FF69B4;\r\n\t\t--theme-secondary: #FF1493;\r\n\t\t--theme-background: #FFF5F8;\r\n\t\t--theme-primary-light: #FF69B420;\r\n\t\t--theme-secondary-light: #FF149320;\r\n\t}\r\n\r\n\t/* 全局样式优化 */\r\n\tpage {\r\n\t\tbackground-color: #f8f9fa;\r\n\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n\t}\r\n\r\n\t/* 通用动画 */\r\n\t.fade-in {\r\n\t\tanimation: fadeIn 0.3s ease-in-out;\r\n\t}\r\n\r\n\t@keyframes fadeIn {\r\n\t\tfrom {\r\n\t\t\topacity: 0;\r\n\t\t\ttransform: translateY(20rpx);\r\n\t\t}\r\n\t\tto {\r\n\t\t\topacity: 1;\r\n\t\t\ttransform: translateY(0);\r\n\t\t}\r\n\t}\r\n\r\n\t.scale-in {\r\n\t\tanimation: scaleIn 0.2s ease-out;\r\n\t}\r\n\r\n\t@keyframes scaleIn {\r\n\t\tfrom {\r\n\t\t\topacity: 0;\r\n\t\t\ttransform: scale(0.9);\r\n\t\t}\r\n\t\tto {\r\n\t\t\topacity: 1;\r\n\t\t\ttransform: scale(1);\r\n\t\t}\r\n\t}\r\n\r\n\t/* 通用卡片样式 */\r\n\t.card {\r\n\t\tbackground: white;\r\n\t\tborder-radius: 20rpx;\r\n\t\tbox-shadow: 0 2rpx 10rpx rgba(0,0,0,0.1);\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t/* 通用按钮样式 */\r\n\t.btn-primary {\r\n\t\tbackground: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary));\r\n\t\tborder: none;\r\n\t\tborder-radius: 50rpx;\r\n\t\tcolor: white;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.btn-secondary {\r\n\t\tbackground: #f8f9fa;\r\n\t\tborder: 2rpx solid #e9ecef;\r\n\t\tborder-radius: 50rpx;\r\n\t\tcolor: #6c757d;\r\n\t}\r\n\r\n\t/* 通用文本样式 */\r\n\t.text-primary {\r\n\t\tcolor: var(--theme-primary);\r\n\t}\r\n\r\n\t.text-secondary {\r\n\t\tcolor: #6c757d;\r\n\t}\r\n\r\n\t.text-success {\r\n\t\tcolor: #28a745;\r\n\t}\r\n\r\n\t.text-warning {\r\n\t\tcolor: #ffc107;\r\n\t}\r\n\r\n\t.text-danger {\r\n\t\tcolor: #dc3545;\r\n\t}\r\n\r\n\t/* 通用间距 */\r\n\t.mt-10 { margin-top: 10rpx; }\r\n\t.mt-20 { margin-top: 20rpx; }\r\n\t.mt-30 { margin-top: 30rpx; }\r\n\t.mb-10 { margin-bottom: 10rpx; }\r\n\t.mb-20 { margin-bottom: 20rpx; }\r\n\t.mb-30 { margin-bottom: 30rpx; }\r\n\t.p-20 { padding: 20rpx; }\r\n\t.p-30 { padding: 30rpx; }\r\n\r\n\t/* 通用布局 */\r\n\t.flex {\r\n\t\tdisplay: flex;\r\n\t}\r\n\r\n\t.flex-center {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.flex-between {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t}\r\n\r\n\t.flex-column {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t/* 响应式字体 */\r\n\t.text-xs { font-size: 20rpx; }\r\n\t.text-sm { font-size: 24rpx; }\r\n\t.text-base { font-size: 28rpx; }\r\n\t.text-lg { font-size: 32rpx; }\r\n\t.text-xl { font-size: 36rpx; }\r\n\t.text-2xl { font-size: 40rpx; }\r\n\r\n\t/* 圆角 */\r\n\t.rounded-sm { border-radius: 8rpx; }\r\n\t.rounded { border-radius: 12rpx; }\r\n\t.rounded-lg { border-radius: 20rpx; }\r\n\t.rounded-full { border-radius: 50%; }\r\n</style>\r\n","import App from './App.vue'\nimport { createSSRApp } from 'vue'\nimport { createPinia } from 'pinia';\nimport uviewPlus from 'uview-plus'\n\n// #ifndef VUE3\nimport Vue from 'vue'\nimport './uni.promisify.adaptor'\nVue.config.productionTip = false\nApp.mpType = 'app'\nconst app = new Vue({\n    ...App\n})\napp.$mount()\n    // #endif\n\n// #ifdef VUE3\nexport function createApp() {\n    const app = createSSRApp(App)\n    const pinia = createPinia()\n    app.use(pinia)\n    app.use(uviewPlus)\n\n    return {\n        app,\n        pinia\n    }\n}\n// #endif"],"names":["uni","useUserStore","useOrderStore","useThemeStore","createSSRApp","App","createPinia","uviewPlus"],"mappings":"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"}