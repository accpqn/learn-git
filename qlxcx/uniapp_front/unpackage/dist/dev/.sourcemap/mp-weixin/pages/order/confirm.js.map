{"version":3,"file":"confirm.js","sources":["pages/order/confirm.vue","../../../../App/hbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvb3JkZXIvY29uZmlybS52dWU"],"sourcesContent":["<template>\n\t<view class=\"confirm-container\">\n\t\t<view class=\"header-section\">\n\t\t\t<text class=\"subtitle\">请确认您要发送给TA的订单</text>\n\t\t</view>\n\n\t\t<view class=\"order-section\">\n\t\t\t<view class=\"section-title\">订单详情</view>\n\t\t\t<view class=\"order-list\">\n\t\t\t\t<view v-for=\"(item, index) in cartItems\" :key=\"index\" class=\"order-item\">\n\t\t\t\t\t<image class=\"item-image\" :src=\"getProductImageUrl(item.item)\" mode=\"aspectFill\"></image>\n\t\t\t\t\t<view class=\"item-info\">\n\t\t\t\t\t\t<text class=\"item-name\">{{ item.item.name }}</text>\n\t\t\t\t\t\t<text class=\"item-desc\">{{ item.item.description }}</text>\n\t\t\t\t\t\t<view class=\"item-bottom\">\n\t\t\t\t\t\t\t<text class=\"item-price\">¥{{ item.item.price }}</text>\n\t\t\t\t\t\t\t<text class=\"item-quantity\">x{{ item.quantity }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"total-section\">\n\t\t\t<view class=\"total-row final\">\n\t\t\t\t<text class=\"total-label\">订单总额</text>\n\t\t\t\t<text class=\"total-value\">¥{{ cartStore.totalPrice }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"note-section\">\n\t\t\t<view class=\"section-title\">订单备注</view>\n\t\t\t<textarea\n\t\t\t\tv-model=\"orderNote\"\n\t\t\t\tplaceholder=\"给TA留个小纸条吧~\"\n\t\t\t\tmaxlength=\"100\"\n\t\t\t\tclass=\"note-textarea\"\n\t\t\t\tauto-height\n\t\t\t></textarea>\n\t\t\t<view class=\"char-count\">{{ orderNote.length }}/100</view>\n\t\t</view>\n\n\t\t<view class=\"bottom-bar\">\n\t\t\t<view class=\"price-info\">\n\t\t\t\t<text class=\"total-text\">总计：¥{{ cartStore.totalPrice }}</text>\n\t\t\t</view>\n\t\t\t<button\n\t\t\t\tclass=\"submit-btn\"\n\t\t\t\t@click=\"submitOrder\"\n\t\t\t\t:disabled=\"submitting || cartItems.length === 0\"\n\t\t\t>\n\t\t\t\t{{ submitting ? '发送中...' : '发送订单' }}\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { useCartStore } from '@/store/cart';\nimport { useOrderStore } from '@/store/order';\nimport { computed, ref } from 'vue';\nimport { getProductImageUrl as getImageUrl } from '@/config/index';\nimport { createOrder } from '@/api/order';\n\nexport default {\n\tsetup() {\n\t\tconst cartStore = useCartStore();\n\t\tconst orderStore = useOrderStore();\n\n\t\tconst orderNote = ref('');\n\t\tconst submitting = ref(false);\n\n\t\tconst cartItems = computed(() => {\n\t\t\treturn Object.values(cartStore.items);\n\t\t});\n\n\t\t// 使用配置文件中的图片URL处理方法\n\t\tconst getProductImageUrl = getImageUrl;\n\n\t\tconst submitOrder = async () => {\n\t\t\tif (cartItems.value.length === 0) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '购物车为空',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsubmitting.value = true;\n\n\t\t\ttry {\n\t\t\t\tconsole.log('购物车原始数据:', cartItems.value);\n\n\t\t\t\t// 检查每个购物车项的数据结构\n\t\t\t\tcartItems.value.forEach((item, index) => {\n\t\t\t\t\tconsole.log(`购物车项 ${index}:`, item);\n\t\t\t\t\tconsole.log(`- item.item:`, item.item);\n\t\t\t\t\tconsole.log(`- item.item.id:`, item.item?.id);\n\t\t\t\t\tconsole.log(`- item.quantity:`, item.quantity);\n\t\t\t\t});\n\n\t\t\t\tconst orderData = {\n\t\t\t\t\tnotes: orderNote.value.trim(),\n\t\t\t\t\titems: cartItems.value.map(item => {\n\t\t\t\t\t\tif (!item.item || !item.item.id) {\n\t\t\t\t\t\t\tconsole.error('购物车项数据异常:', item);\n\t\t\t\t\t\t\tthrow new Error('购物车数据异常，请重新添加商品');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tproduct: item.item.id,\n\t\t\t\t\t\t\tquantity: item.quantity\n\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t};\n\n\t\t\t\tconsole.log('提交订单数据:', orderData);\n\n\t\t\t\t// 使用OrderStore创建订单，它会处理API调用和数据同步\n\t\t\t\tconst result = await orderStore.createOrder(orderData);\n\t\t\t\tconsole.log('订单创建结果:', result);\n\n\t\t\t\t// 清空购物车\n\t\t\t\tcartStore.clearCart();\n\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '订单发送成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t});\n\n\t\t\t\t// 跳转到订单列表并刷新数据\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\turl: '/pages/order/list'\n\t\t\t\t\t});\n\t\t\t\t}, 1500);\n\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('提交订单失败:', error);\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '发送失败: ' + (error.message || '未知错误'),\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tsubmitting.value = false;\n\t\t\t}\n\t\t};\n\n\t\treturn {\n\t\t\tcartStore,\n\t\t\tcartItems,\n\t\t\torderNote,\n\t\t\tsubmitting,\n\t\t\tgetProductImageUrl,\n\t\t\tsubmitOrder\n\t\t};\n\t}\n}\n</script>\n\n<style lang=\"scss\">\n.confirm-container {\n\tpadding: 20rpx;\n\tpadding-bottom: 200rpx;\n}\n\n.header-section {\n\ttext-align: center;\n\tmargin-bottom: 40rpx;\n\t\n\t.title {\n\t\tfont-size: 36rpx;\n\t\tfont-weight: bold;\n\t\tdisplay: block;\n\t}\n\t\n\t.subtitle {\n\t\tfont-size: 28rpx;\n\t\tcolor: #909399;\n\t\tmargin-top: 10rpx;\n\t\tdisplay: block;\n\t}\n}\n\n.section-title {\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tmargin-bottom: 20rpx;\n}\n\n.order-section {\n\tbackground: #fff;\n\tborder-radius: 20rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.order-item {\n\tdisplay: flex;\n\tpadding: 20rpx 0;\n\tborder-bottom: 1rpx solid #f0f0f0;\n\t\n\t&:last-child {\n\t\tborder-bottom: none;\n\t}\n}\n\n.item-image {\n\tflex-shrink: 0;\n\tborder-radius: 10rpx;\n\twidth: 120rpx;\n\theight: 120rpx;\n}\n\n.item-info {\n\tflex: 1;\n\tmargin-left: 20rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.item-name {\n\tfont-size: 30rpx;\n\tfont-weight: bold;\n}\n\n.item-desc {\n\tfont-size: 24rpx;\n\tcolor: #909399;\n\tmargin: 10rpx 0;\n}\n\n.item-bottom {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-top: auto;\n}\n\n.item-price {\n\tfont-size: 28rpx;\n\tcolor: #fa3534;\n\tfont-weight: bold;\n}\n\n.item-quantity {\n\tfont-size: 28rpx;\n\tcolor: #909399;\n}\n\n.total-section {\n\tbackground: #fff;\n\tborder-radius: 20rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.total-row {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 10rpx 0;\n\t\n\t&.final {\n\t\tborder-top: 1rpx solid #f0f0f0;\n\t\tmargin-top: 20rpx;\n\t\tpadding-top: 20rpx;\n\t\tfont-weight: bold;\n\t\tfont-size: 32rpx;\n\t}\n}\n\n.total-label {\n\tfont-size: 28rpx;\n}\n\n.total-value {\n\tfont-size: 28rpx;\n\tcolor: #fa3534;\n}\n\n.note-section {\n\tbackground: #fff;\n\tborder-radius: 20rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.note-textarea {\n\twidth: 100%;\n\tmin-height: 120rpx;\n\tpadding: 20rpx;\n\tborder: 1rpx solid #E0E0E0;\n\tborder-radius: 10rpx;\n\tfont-size: 28rpx;\n\tline-height: 1.5;\n\tbackground: #F8F9FA;\n\n\t&:focus {\n\t\tborder-color: #FF69B4;\n\t\tbackground: #FFF;\n\t}\n}\n\n.char-count {\n\ttext-align: right;\n\tfont-size: 24rpx;\n\tcolor: #909399;\n\tmargin-top: 10rpx;\n}\n\n.bottom-bar {\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n\theight: 120rpx;\n\tbackground: #fff;\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 0 30rpx;\n\tbox-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.1);\n}\n\n.price-info {\n\tflex: 1;\n}\n\n.total-text {\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #fa3534;\n}\n\n.submit-btn {\n\tbackground: linear-gradient(135deg, #FF69B4, #FF1493);\n\tcolor: white;\n\tborder: none;\n\tborder-radius: 50rpx;\n\tpadding: 20rpx 40rpx;\n\tfont-size: 28rpx;\n\tfont-weight: bold;\n\tbox-shadow: 0 4rpx 15rpx rgba(255, 105, 180, 0.3);\n\n\t&::after {\n\t\tborder: none;\n\t}\n\n\t&:disabled {\n\t\tbackground: #CCC;\n\t\tbox-shadow: none;\n\t}\n\n\t&:not(:disabled):active {\n\t\ttransform: translateY(2rpx);\n\t}\n}\n</style>\n","import MiniProgramPage from 'D:/Python/python_doc/xcx/uniapp_front/pages/order/confirm.vue'\nwx.createPage(MiniProgramPage)"],"names":["useCartStore","useOrderStore","ref","computed","getImageUrl","uni"],"mappings":";;;;;;AAgEA,MAAK,YAAU;AAAA,EACd,QAAQ;AACP,UAAM,YAAYA,WAAAA;AAClB,UAAM,aAAaC,YAAAA;AAEnB,UAAM,YAAYC,kBAAI,EAAE;AACxB,UAAM,aAAaA,kBAAI,KAAK;AAE5B,UAAM,YAAYC,cAAAA,SAAS,MAAM;AAChC,aAAO,OAAO,OAAO,UAAU,KAAK;AAAA,IACrC,CAAC;AAGD,UAAM,qBAAqBC,aAAAA;AAE3B,UAAM,cAAc,YAAY;AAC/B,UAAI,UAAU,MAAM,WAAW,GAAG;AACjCC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AACD;AAAA,MACD;AAEA,iBAAW,QAAQ;AAEnB,UAAI;AACHA,sBAAA,MAAA,MAAA,OAAA,iCAAY,YAAY,UAAU,KAAK;AAGvC,kBAAU,MAAM,QAAQ,CAAC,MAAM,UAAU;;AACxCA,8BAAY,MAAA,OAAA,iCAAA,QAAQ,KAAK,KAAK,IAAI;AAClCA,8BAAY,MAAA,OAAA,iCAAA,gBAAgB,KAAK,IAAI;AACrCA,8BAAA,MAAA,OAAA,iCAAY,oBAAmB,UAAK,SAAL,mBAAW,EAAE;AAC5CA,8BAAA,MAAA,OAAA,iCAAY,oBAAoB,KAAK,QAAQ;AAAA,QAC9C,CAAC;AAED,cAAM,YAAY;AAAA,UACjB,OAAO,UAAU,MAAM,KAAM;AAAA,UAC7B,OAAO,UAAU,MAAM,IAAI,UAAQ;AAClC,gBAAI,CAAC,KAAK,QAAQ,CAAC,KAAK,KAAK,IAAI;AAChCA,4BAAc,MAAA,MAAA,SAAA,kCAAA,aAAa,IAAI;AAC/B,oBAAM,IAAI,MAAM,iBAAiB;AAAA,YAClC;AACA,mBAAO;AAAA,cACN,SAAS,KAAK,KAAK;AAAA,cACnB,UAAU,KAAK;AAAA;WAEhB;AAAA;AAGFA,sBAAY,MAAA,MAAA,OAAA,kCAAA,WAAW,SAAS;AAGhC,cAAM,SAAS,MAAM,WAAW,YAAY,SAAS;AACrDA,sBAAA,MAAA,MAAA,OAAA,kCAAY,WAAW,MAAM;AAG7B,kBAAU,UAAS;AAEnBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAGD,mBAAW,MAAM;AAChBA,wBAAAA,MAAI,UAAU;AAAA,YACb,KAAK;AAAA,UACN,CAAC;AAAA,QACD,GAAE,IAAI;AAAA,MAEN,SAAO,OAAO;AACfA,sBAAA,MAAA,MAAA,SAAA,kCAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,YAAY,MAAM,WAAW;AAAA,UACpC,MAAM;AAAA,QACP,CAAC;AAAA,MACF,UAAU;AACT,mBAAW,QAAQ;AAAA,MACpB;AAAA;AAGD,WAAO;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;EAEF;AACD;;;;;;;;;;;;;;;;;;;;;;;;AC3JA,GAAG,WAAW,eAAe;"}