"use strict";const e=require("../common/vendor.js"),n=require("../api/core.js"),t=require("../api/user.js"),i=require("./user.js"),r=e.defineStore("couple",{state:()=>({bindingInfo:null,theme:{backgroundColor:"#FFFFFF",primaryColor:"#007AFF",backgroundImage:null},bindingRequestStatus:"idle",bindingRequestError:null}),getters:{isBindingActive:e=>!!e.bindingInfo&&"active"===e.bindingInfo.status,partnerId:e=>{if(!e.bindingInfo)return null;const n=i.useUserStore(),{requester:t,receiver:r}=e.bindingInfo;return t.id===n.userId?r.id:t.id},partnerInfo:e=>{if(!e.bindingInfo)return null;const n=i.useUserStore(),{requester:t,receiver:r}=e.bindingInfo;return t.id===n.userId?r:t}},actions:{setBindingInfo(e){this.bindingInfo=e},setTheme(e){this.theme={...this.theme,...e}},async sendBindingRequest(e){this.bindingRequestStatus="pending",this.bindingRequestError=null;try{return await t.sendBindingRequest(e),this.bindingRequestStatus="success",!0}catch(n){return this.bindingRequestStatus="error",this.bindingRequestError=n.message,!1}},async respondToBinding(n,i){try{const e=await t.respondToBinding(n,i);return"accept"===i&&(this.bindingInfo=e),!0}catch(r){return e.index.showToast({title:r.message||"操作失败",icon:"none"}),!1}},async unbind(){if(!this.bindingInfo)return!1;try{return await t.unbind(this.bindingInfo.id),this.bindingInfo=null,!0}catch(n){return e.index.showToast({title:n.message||"解除绑定失败",icon:"none"}),!1}},async loadTheme(){try{const e=await n.themeApi.get();return this.setTheme(e),!0}catch(e){return console.error("Failed to load theme:",e),!1}},async updateTheme(t){try{return await n.themeApi.update(t),this.setTheme(t),!0}catch(i){return e.index.showToast({title:i.message||"更新主题失败",icon:"none"}),!1}}}});exports.useCoupleStore=r;
