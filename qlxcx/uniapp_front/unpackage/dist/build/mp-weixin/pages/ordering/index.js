"use strict";const e=require("../../common/vendor.js"),t=require("../../store/menu.js"),o=require("../../store/cart.js"),r=require("../../store/user.js"),n=require("../../config/index.js"),a={setup(){const a=t.useMenuStore(),u=o.useCartStore(),s=r.useUserStore(),i=e.ref(!1),c=e.ref(null),d=e.ref(0),l=e.computed((()=>s.isLoggedIn)),g=()=>{const e=a.useRealApi,t=s.isLoggedIn;t!==e?(console.log(`数据源切换: ${e?"真实":"模拟"} -> ${t?"真实":"模拟"}`),a.setApiMode(t),a.fetchMenuData()):t?console.log("用户已登录，使用真实API数据"):console.log("用户未登录，使用模拟数据")};e.onMounted((()=>{g(),u.initCart()})),e.onShow((()=>{console.log("点餐页面显示，检查登录状态"),g()}));const m=e.computed((()=>{var e;return(null==(e=a.categories.find((e=>e.id===a.currentCategoryId)))?void 0:e.name)||""})),y=e.computed((()=>{const e=a.categories.find((e=>e.id===a.currentCategoryId));return e?e.description:""})),C=n.getProductImageUrl;return{menuStore:a,cartStore:u,isLoggedIn:l,showProductModal:i,selectedProduct:c,currentQuantity:d,currentCategoryName:m,currentCategoryDesc:y,getGreeting:()=>{const e=(new Date).getHours();return e<12?"早餐时光，为TA准备营养早餐吧":e<14?"午餐时间，来点什么好呢？":e<18?"下午茶时光，甜蜜一下":"晚餐时间，和TA一起享受美食"},getCategoryProductCount:e=>{var t;return(null==(t=a.products[e])?void 0:t.length)||0},handleCategoryChange:e=>{a.setCurrentCategory(e)},handleQuantityChange:(e,t)=>{u.setItemQuantity(t,e.value)},showProductDetail:e=>{c.value=e;const t=u.getItemQuantity(e.id);d.value=t>0?t:1,i.value=!0},increaseQuantity:()=>{console.log("点击增加按钮，当前商品:",c.value),c.value?(d.value++,console.log("数量增加到:",d.value)):console.log("商品未选择")},decreaseQuantity:()=>{console.log("点击减少按钮，当前数量:",d.value),d.value>1?(d.value--,console.log("数量减少到:",d.value)):console.log("数量已经是最小值")},addToCart:()=>{c.value&&d.value>0&&(console.log("加入购物车:",c.value,d.value),u.setItemQuantity(c.value,d.value),i.value=!1,e.index.showToast({title:"已加入购物车",icon:"success"}))},addProductToCart:t=>{if(console.log("=== 点击加号按钮 ==="),console.log("商品信息:",t),console.log("商品ID:",null==t?void 0:t.id),console.log("商品名称:",null==t?void 0:t.name),t){console.log("添加到购物车");try{u.setItemQuantity(t,1),console.log("购物车操作完成"),e.index.showToast({title:"已加入购物车",icon:"success"})}catch(o){console.error("购物车操作失败:",o),e.index.showToast({title:"添加失败",icon:"error"})}}else console.log("商品信息无效"),e.index.showToast({title:"商品信息无效",icon:"none"})},increaseProductQuantity:e=>{const t=u.getItemQuantity(e.id);u.setItemQuantity(e,t+1)},decreaseProductQuantity:e=>{const t=u.getItemQuantity(e.id);t>1?u.setItemQuantity(e,t-1):1===t&&u.setItemQuantity(e,0)},showCartDetail:()=>{e.index.showToast({title:`购物车中有${u.totalItems}件商品`,icon:"none"})},goToConfirm:()=>{0!==u.totalItems?e.index.navigateTo({url:"/pages/order/confirm"}):e.index.showToast({title:"请先选择商品",icon:"none"})},goToLogin:()=>{e.index.navigateTo({url:"/pages/public/login"})},reloadMenu:()=>{a.fetchMenuData()},getProductImageUrl:C}}};if(!Array){(e.resolveComponent("u-loading-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-empty")+e.resolveComponent("u-transition"))()}const u=e._export_sfc(a,[["render",function(t,o,r,n,a,u){return e.e({a:e.t(n.getGreeting()),b:e.t(n.isLoggedIn?"真实数据":"模拟数据"),c:!n.isLoggedIn},n.isLoggedIn?{}:{d:e.o(((...e)=>n.goToLogin&&n.goToLogin(...e)))},{e:e.f(n.menuStore.categories,((t,o,r)=>e.e({a:e.t(t.name),b:n.getCategoryProductCount(t.id)>0},n.getCategoryProductCount(t.id)>0?{c:e.t(n.getCategoryProductCount(t.id))}:{},{d:t.id,e:e.n({active:t.id===n.menuStore.currentCategoryId}),f:e.o((e=>n.handleCategoryChange(t.id)),t.id)}))),f:"loading"===n.menuStore.status},"loading"===n.menuStore.status?{g:e.p({text:"正在加载菜单...",size:"24"})}:"error"===n.menuStore.status?{i:e.o(n.reloadMenu),j:e.p({text:"重新加载",type:"primary",size:"small"}),k:e.p({text:"加载失败",mode:"error"})}:e.e({l:e.t(n.currentCategoryName),m:e.t(n.currentCategoryDesc),n:0===n.menuStore.currentProducts.length},0===n.menuStore.currentProducts.length?{o:e.p({text:"该分类暂无商品",mode:"data"})}:{p:e.f(n.menuStore.currentProducts,((t,o,r)=>e.e({a:n.getProductImageUrl(t),b:e.o((e=>n.showProductDetail(t)),t.id),c:e.t(t.name),d:e.t(t.description),e:e.t(t.price),f:e.o((e=>n.showProductDetail(t)),t.id),g:n.cartStore.getItemQuantity(t.id)>0},n.cartStore.getItemQuantity(t.id)>0?{h:e.o((e=>n.decreaseProductQuantity(t)),t.id),i:e.t(n.cartStore.getItemQuantity(t.id)),j:e.o((e=>n.increaseProductQuantity(t)),t.id)}:{k:e.o((e=>n.addProductToCart(t)),t.id)},{l:t.id})))}),{h:"error"===n.menuStore.status,q:e.t(n.cartStore.totalItems),r:e.t(n.cartStore.totalItems),s:e.t(n.cartStore.totalPrice),t:e.o(((...e)=>n.showCartDetail&&n.showCartDetail(...e))),v:e.o(((...e)=>n.goToConfirm&&n.goToConfirm(...e))),w:0===n.cartStore.totalItems,x:e.p({show:n.cartStore.totalItems>0,mode:"slide-up"}),y:n.showProductModal},n.showProductModal?e.e({z:n.selectedProduct},n.selectedProduct?{A:e.o((e=>n.showProductModal=!1)),B:n.getProductImageUrl(n.selectedProduct),C:e.t(n.selectedProduct.name),D:e.t(n.selectedProduct.description),E:e.t(n.selectedProduct.price),F:e.o(((...e)=>n.decreaseQuantity&&n.decreaseQuantity(...e))),G:n.currentQuantity<=1,H:e.t(n.currentQuantity),I:e.o(((...e)=>n.increaseQuantity&&n.increaseQuantity(...e))),J:e.o(((...e)=>n.addToCart&&n.addToCart(...e))),K:n.currentQuantity<=0,L:e.o((()=>{}))}:{},{M:e.o((e=>n.showProductModal=!1))}):{})}]]);wx.createPage(u);
