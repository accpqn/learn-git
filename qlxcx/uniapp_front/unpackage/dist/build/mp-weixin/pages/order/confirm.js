"use strict";const e=require("../../common/vendor.js"),t=require("../../store/cart.js"),r=require("../../store/order.js"),o=require("../../config/index.js");require("../../api/request.js");const i={setup(){const i=t.useCartStore(),s=r.useOrderStore(),n=e.ref(""),c=e.ref(!1),a=e.computed((()=>Object.values(i.items))),l=o.getProductImageUrl;return{cartStore:i,cartItems:a,orderNote:n,submitting:c,getProductImageUrl:l,submitOrder:async()=>{if(0!==a.value.length){c.value=!0;try{console.log("购物车原始数据:",a.value),a.value.forEach(((e,t)=>{var r;console.log(`购物车项 ${t}:`,e),console.log("- item.item:",e.item),console.log("- item.item.id:",null==(r=e.item)?void 0:r.id),console.log("- item.quantity:",e.quantity)}));const t={notes:n.value.trim(),items:a.value.map((e=>{if(!e.item||!e.item.id)throw console.error("购物车项数据异常:",e),new Error("购物车数据异常，请重新添加商品");return{product:e.item.id,quantity:e.quantity}}))};console.log("提交订单数据:",t);const r=await s.createOrder(t);console.log("订单创建结果:",r),i.clearCart(),e.index.showToast({title:"订单发送成功",icon:"success"}),setTimeout((()=>{e.index.switchTab({url:"/pages/order/list"})}),1500)}catch(t){console.error("提交订单失败:",t),e.index.showToast({title:"发送失败: "+(t.message||"未知错误"),icon:"none"})}finally{c.value=!1}}else e.index.showToast({title:"购物车为空",icon:"none"})}}}};const s=e._export_sfc(i,[["render",function(t,r,o,i,s,n){return{a:e.f(i.cartItems,((t,r,o)=>({a:i.getProductImageUrl(t.item),b:e.t(t.item.name),c:e.t(t.item.description),d:e.t(t.item.price),e:e.t(t.quantity),f:r}))),b:e.t(i.cartStore.totalPrice),c:i.orderNote,d:e.o((e=>i.orderNote=e.detail.value)),e:e.t(i.orderNote.length),f:e.t(i.cartStore.totalPrice),g:e.t(i.submitting?"发送中...":"发送订单"),h:e.o(((...e)=>i.submitOrder&&i.submitOrder(...e))),i:i.submitting||0===i.cartItems.length}}]]);wx.createPage(s);
