"use strict";const e=require("../../common/vendor.js"),t=require("../../store/order.js"),r=require("../../store/user.js"),a={setup(){const a=t.useOrderStore(),o=r.useUserStore(),s=e.ref(0),n=e.computed((()=>o.isLoggedIn)),i=[{id:"demo-1",creator:"demo",creator_username:"演示用户",status:"PENDING",notes:"这是一个演示订单，登录后查看真实数据",total_price:"45.00",created_at:"2024-06-22T10:30:00Z",items:[{product:{name:"宫保鸡丁",price:"25.00"},quantity:1},{product:{name:"米饭",price:"3.00"},quantity:2}]},{id:"demo-2",creator:"demo",creator_username:"演示用户",status:"COMPLETED",notes:"美味的午餐",total_price:"32.00",created_at:"2024-06-21T12:15:00Z",items:[{product:{name:"红烧肉",price:"28.00"},quantity:1},{product:{name:"汤",price:"4.00"},quantity:1}]}],d=[{id:"demo-3",creator:"demo-partner",creator_username:"TA",status:"CONFIRMED",notes:"TA为你点的爱心餐",total_price:"38.00",created_at:"2024-06-22T11:00:00Z",items:[{product:{name:"糖醋里脊",price:"26.00"},quantity:1},{product:{name:"蛋花汤",price:"6.00"},quantity:2}]}],c=e.computed((()=>n.value?a.sentOrders:i)),l=e.computed((()=>n.value?a.receivedOrders:d)),g=async()=>{if(o.isLoggedIn){console.log("刷新订单数据...");try{await Promise.all([a.fetchSentOrders(),a.fetchReceivedOrders()]),console.log("订单数据刷新完成")}catch(e){console.error("刷新订单数据失败:",e)}}};e.onMounted((()=>{o.isLoggedIn&&(a.initOrders(),g())})),e.onShow((()=>{console.log("订单页面显示"),o.isLoggedIn&&g()}));return{isLoggedIn:n,orderStore:a,currentTab:s,tabList:[{name:"我发出的"},{name:"我收到的"}],displaySentOrders:c,displayReceivedOrders:l,goToLogin:()=>{e.index.navigateTo({url:"/pages/public/login"})},handleTabClick:e=>{s.value=e.index},handleSwiperChange:e=>{s.value=e.detail.current},formatDate:t=>e.dayjs(t).format("MM-DD HH:mm"),getStatusText:e=>({PENDING:"待处理",CONFIRMED:"已确认",ORDERED:"已下单",COMPLETED:"已完成",RATED:"已评价",CANCELLED:"已取消",pending:"待处理",accepted:"已接收",completed:"已完成"}[e]||"未知"),getStatusClass:e=>`status-${e}`,navigateToDetail:t=>{n.value||!t.startsWith("demo-")?e.index.navigateTo({url:`/pages/order/detail?id=${t}`}):e.index.showToast({title:"请登录查看订单详情",icon:"none"})},handleRefresh:()=>{e.index.showToast({title:"刷新中...",icon:"loading"}),g().then((()=>{e.index.hideToast(),e.index.showToast({title:"刷新完成",icon:"success",duration:1e3})}))},refreshOrders:g}}};const o=e._export_sfc(a,[["render",function(t,r,a,o,s,n){return e.e({a:!o.isLoggedIn},o.isLoggedIn?{}:{b:e.o(((...e)=>o.goToLogin&&o.goToLogin(...e)))},{c:e.f(o.tabList,((t,r,a)=>({a:e.t(t.name),b:r,c:o.currentTab===r?1:"",d:e.o((e=>o.handleTabClick({index:r})),r)}))),d:e.o(((...e)=>o.handleRefresh&&o.handleRefresh(...e))),e:o.isLoggedIn&&"loading"===o.orderStore.status},o.isLoggedIn&&"loading"===o.orderStore.status?{}:e.e({f:e.f(o.displaySentOrders,((t,r,a)=>e.e({a:e.t(t.id),b:e.t(o.getStatusText(t.status)),c:e.n(o.getStatusClass(t.status)),d:e.t(o.formatDate(t.created_at||t.createTime)),e:e.t(t.items.length),f:e.t(t.total_price||t.totalPrice),g:t.notes||t.note},t.notes||t.note?{h:e.t(t.notes||t.note)}:{},{i:t.id,j:e.o((e=>o.navigateToDetail(t.id)),t.id)}))),g:0===o.displaySentOrders.length},(o.displaySentOrders.length,{})),{h:o.isLoggedIn&&"loading"===o.orderStore.status},o.isLoggedIn&&"loading"===o.orderStore.status?{}:e.e({i:e.f(o.displayReceivedOrders,((t,r,a)=>e.e({a:e.t(t.id),b:e.t(o.getStatusText(t.status)),c:e.n(o.getStatusClass(t.status)),d:e.t(o.formatDate(t.created_at||t.createTime)),e:e.t(t.items.length),f:e.t(t.total_price||t.totalPrice),g:t.notes||t.note},t.notes||t.note?{h:e.t(t.notes||t.note)}:{},{i:t.id,j:e.o((e=>o.navigateToDetail(t.id)),t.id)}))),j:0===o.displayReceivedOrders.length},(o.displayReceivedOrders.length,{})),{k:o.currentTab,l:e.o(((...e)=>o.handleSwiperChange&&o.handleSwiperChange(...e)))})}]]);wx.createPage(o);
