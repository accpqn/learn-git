"use strict";const e=require("../../common/vendor.js"),a=require("../../store/user.js");var o={VITE_CJS_IGNORE_WARNING:"true",VITE_ROOT_DIR:"D:/Python/python_doc/xcx/uniapp_front",VITE_USER_NODE_ENV:"production",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const t={setup(){const t=a.useUserStore(),s=e.ref(!1),r=e.ref({username:"",email:"",bio:""}),n=e.computed((()=>t.userInfo));e.onMounted((()=>{n.value&&(r.value={username:n.value.username||"",email:n.value.email||"",bio:n.value.bio||""})}));const i=()=>{e.index.navigateBack()};return{formData:r,saving:s,getUserAvatarUrl:()=>{var e;return(null==(e=n.value)?void 0:e.avatar_url)?n.value.avatar_url.startsWith("http")?n.value.avatar_url:`${o.VITE_API_BASE_URL||"http://127.0.0.1:8000"}${n.value.avatar_url}`:"/static/images/default-avatar.png"},changeAvatar:()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async a=>{const o=a.tempFilePaths[0];console.log("选择的头像:",o),e.index.showLoading({title:"上传中..."});try{const{uploadAvatar:a}=await"../../api/user.js",s=await a(o);console.log("头像上传成功:",s),s.user&&(t.userInfo=s.user,t.saveUserToLocal()),e.index.hideLoading(),e.index.showToast({title:"头像更新成功",icon:"success"})}catch(s){console.error("头像上传失败:",s),e.index.hideLoading(),e.index.showToast({title:"头像上传失败: "+(s.message||"网络错误"),icon:"none"})}},fail:a=>{console.error("选择图片失败:",a),e.index.showToast({title:"选择图片失败",icon:"none"})}})},saveProfile:async()=>{if(!r.value.username.trim())return void e.index.showToast({title:"请输入用户名",icon:"none"});if(!r.value.email.trim())return void e.index.showToast({title:"请输入邮箱地址",icon:"none"});if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value.email)){s.value=!0;try{console.log("保存用户信息:",r.value);const{updateUserProfile:a}=await"../../api/user.js",o=await a(r.value);console.log("用户信息更新成功:",o),t.userInfo={...t.userInfo,...o},t.saveUserToLocal(),e.index.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{i()}),1500)}catch(a){console.error("保存失败:",a),e.index.showToast({title:"保存失败: "+(a.message||"网络错误"),icon:"none"})}finally{s.value=!1}}else e.index.showToast({title:"邮箱格式不正确",icon:"none"})},goBack:i}}};const s=e._export_sfc(t,[["render",function(a,o,t,s,r,n){return{a:s.getUserAvatarUrl(),b:e.o(((...e)=>s.changeAvatar&&s.changeAvatar(...e))),c:s.formData.username,d:e.o((e=>s.formData.username=e.detail.value)),e:s.formData.email,f:e.o((e=>s.formData.email=e.detail.value)),g:s.formData.bio,h:e.o((e=>s.formData.bio=e.detail.value)),i:e.t(s.formData.bio.length),j:e.t(s.saving?"保存中...":"保存修改"),k:e.o(((...e)=>s.saveProfile&&s.saveProfile(...e))),l:s.saving,m:e.o(((...e)=>s.goBack&&s.goBack(...e)))}}]]);wx.createPage(s);
