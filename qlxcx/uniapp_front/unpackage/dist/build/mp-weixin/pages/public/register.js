"use strict";const e=require("../../common/vendor.js"),s=require("../../utils/config.js"),o=require("../../store/user.js"),i={components:{AgreementLinks:()=>"../../components/public/AgreementLinks.js"},setup:()=>({userStore:o.useUserStore()}),data:()=>({form:{email:"",password:"",confirmPassword:"",code:""},countdown:0,loginUrl:s.APP_CONFIG.pages.login}),computed:{isFormValid(){return this.form.email&&this.form.password&&this.form.confirmPassword&&this.form.code&&this.form.password===this.form.confirmPassword},isEmailValid(){return this.validateEmail(this.form.email)},isRegistering(){return"pending"===this.userStore.registerStatus}},methods:{validateEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),async handleSendCode(){if(this.isEmailValid)try{await this.userStore.sendVerificationCode(this.form.email),this.countdown=60;const s=setInterval((()=>{this.countdown--,this.countdown<=0&&clearInterval(s)}),1e3);e.index.showToast({title:"验证码已发送",icon:"success"})}catch(s){e.index.showToast({title:s.message||"发送验证码失败",icon:"none"})}else e.index.showToast({title:"请输入有效的邮箱地址",icon:"none"})},async handleRegister(){if(this.isFormValid)if(this.isEmailValid)try{await this.userStore.register({email:this.form.email,password:this.form.password,code:this.form.code})&&(e.index.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{e.index.reLaunch({url:s.APP_CONFIG.pages.binding})}),1500))}catch(o){e.index.showToast({title:o.message||"注册失败",icon:"none"})}else e.index.showToast({title:"请输入有效的邮箱地址",icon:"none"})}}};if(!Array){e.resolveComponent("agreement-links")()}const t=e._export_sfc(i,[["render",function(s,o,i,t,r,n){return{a:r.form.email,b:e.o((e=>r.form.email=e.detail.value)),c:r.form.code,d:e.o((e=>r.form.code=e.detail.value)),e:e.t(r.countdown>0?`${r.countdown}秒后重试`:"获取验证码"),f:!n.isEmailValid||r.countdown>0,g:e.o(((...e)=>n.handleSendCode&&n.handleSendCode(...e))),h:r.form.password,i:e.o((e=>r.form.password=e.detail.value)),j:r.form.confirmPassword,k:e.o((e=>r.form.confirmPassword=e.detail.value)),l:e.t(n.isRegistering?"注册中...":"注册"),m:e.o(((...e)=>n.handleRegister&&n.handleRegister(...e))),n:!n.isFormValid||n.isRegistering,o:r.loginUrl}}]]);wx.createPage(t);
